"use strict";
var boxesHeight;
function close_booked_modal(){jQuery(".booked-modal").fadeOut(200),jQuery(".booked-modal").addClass("bm-closing"),jQuery("body").css({overflow:"auto"}),setTimeout(function(){jQuery(".booked-modal").remove()},300)}function adjust_calendar_boxes(){jQuery(".booked-calendar").each(function(){var a=jQuery(this).find("tbody tr.week td").width(),b=jQuery(this).height();boxesHeight=.8*a,jQuery(this).find("tbody tr.week td").height(boxesHeight),jQuery(this).find("tbody tr.week td .date").css("line-height",boxesHeight+"px");var b=jQuery(this).height();jQuery(this).parent().height(b),jQuery(".tooltipster").tooltipster({theme:"tooltipster-light",delay:500})})}var booked_load_calendar_date_booking_options;!function(a,b,c,d){function e(){var c=a(b).height(),d=a(b).width();if(d>720)var e=c-295;else var e=c;a("body *").blur(),a("body").css({overflow:"hidden"}),a('<div class="booked-modal"><div class="bm-overlay"></div><div class="bm-window"><div style="height:100px"></div></div></div>').appendTo("body"),a(".booked-modal .bm-window").spin("booked"),a(".booked-modal .bm-window").css({"max-height":e+"px"})}function f(){var c=a(b).height(),d=a(b).width();if(d>720)var e=c-295;else var e=c;a(".booked-modal .bm-window").css({"max-height":e+"px"})}function g(b,c){if(b="undefined"==typeof b||b,c="undefined"!=typeof c&&c)var d=c.find("li.active .savingState, .topSavingState.savingState, .calendarSavingState"),e=c.find(".monthName"),f=c.find("table.booked-calendar tbody");else var d=a("li.active .savingState, .topSavingState.savingState, .calendarSavingState"),e=a(".monthName"),f=a("table.booked-calendar tbody");b?(d.fadeIn(200),e.hide(),f.animate({opacity:.2},100)):(d.hide(),e.show(),f.animate({opacity:1},0))}a(".booked_calendar_chooser").change(function(c){c.preventDefault();var d=a(this),e=a("#data-ajax-url").html(),f=d.parents(".booked-calendar-shortcode-wrap").find(".booked-calendar-wrap"),h={load:"calendar_month",gotoMonth:!1,calendar_id:d.val()};return g(!0,f),f.load(e,h,function(){adjust_calendar_boxes(),a(b).trigger("booked-load-calendar",h,d)}),!1});var h=a(b);a.fn.spin.presets.booked={lines:10,length:7,width:5,radius:11,corners:1,rotate:0,direction:1,color:"#555",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"booked-spinner",zIndex:2e9,top:"50%",left:"50%"},h.on("load",function(){var d=[];setTimeout(function(){a("#data-ajax-url *").contents().unwrap()},1),a(".booked-calendar-wrap").on("click",".page-right, .page-left, .monthName a",function(c){c.preventDefault();var d=a(this),e=d.attr("data-goto"),f=a("#data-ajax-url").html(),h=d.parents(".booked-calendar-wrap");return calendar_id=d.parents("table.booked-calendar").attr("data-calendar-id"),args={load:"calendar_month",gotoMonth:e,calendar_id:calendar_id},g(!0,h),h.load(f,args,function(){adjust_calendar_boxes(),a(b).trigger("booked-load-calendar",args,d)}),!1}),a(".booked-calendar-wrap").on("click","tr.week td",function(b){a("table.booked-calendar td.active").removeClass("active"),a(this).addClass("active")}),a(".booked-calendar-wrap").on("click","tr.entryBlock button.new-appt",function(b){b.preventDefault();var d=a(this),f=d.attr("data-timeslot"),g=d.attr("data-date"),h=(d.parents(".timeslot"),a("#data-ajax-url").html()),i=d.parents("table.booked-calendar").attr("data-calendar-id");return booked_load_calendar_date_booking_options={load:"new_appointment_form",date:g,timeslot:f,calendar_id:i},a(c).trigger("booked-before-loading-calendar-booking-options"),e(),a(".bm-window").load(h,booked_load_calendar_date_booking_options,function(b){a(c).trigger("booked-on-new-app")}),!1});var i=a(".booked-tabs");if(i.find("li.active").length||i.find("li:first-child").addClass("active"),i.length){a(".booked-tab-content").hide();var j=i.find(".active > a").attr("href");j=j.split("#"),j=j[1],a("#profile-"+j).show(),i.find("li > a").on("click",function(b){b.preventDefault(),a(".booked-tab-content").hide(),i.find("li").removeClass("active"),a(this).parent().addClass("active");var c=a(this).attr("href");return c=c.split("#"),c=c[1],a("#profile-"+c).show(),!1})}a(".booked-profile-appt-list").on("click",".booked-show-cf",function(b){b.preventDefault();var c=a(this).parent().find(".cf-meta-values-hidden");return c.is(":visible")?c.hide():c.show(),!1}),a("#loginform").length&&a('#loginform input[type="submit"]').on("click",function(b){a('#loginform input[name="log"]').val()&&a('#loginform input[name="pwd"]').val()?a("#loginform .booked-custom-error").hide():(b.preventDefault(),a("#loginform").parents(".booked-form-wrap").find(".booked-custom-error").fadeOut(200).fadeIn(200))}),a("#profile-forgot").length&&a('#profile-forgot input[type="submit"]').on("click",function(b){a('#profile-forgot input[name="user_login"]').val()?a("#profile-forgot .booked-custom-error").hide():(b.preventDefault(),a("#profile-forgot").find(".booked-custom-error").fadeOut(200).fadeIn(200))}),a(".booked-upload-wrap").length&&a(".booked-upload-wrap input[type=file]").on("change",function(){var b=a(this).val();a(this).parent().find("span").html(b),a(this).parent().addClass("hasFile")}),a(".booked-profile-appt-list").on("click",".appt-block .cancel",function(b){b.preventDefault();var c=a(this),e=c.parents(".appt-block"),f=e.attr("data-appt-id"),g=a("#data-ajax-url").html();if(confirm_delete=confirm(i18n_confirm_appt_delete),1==confirm_delete){var h=parseInt(a(".booked-profile-appt-list").find("h4").find("span.count").html(),10);h=parseInt(h-1,10),1>h?(a(".booked-profile-appt-list").find("h4").find("span.count").html("0"),a(".no-appts-message").slideDown("fast")):a(".booked-profile-appt-list").find("h4").find("span.count").html(h),a(".appt-block").animate({opacity:.4},0),e.slideUp("fast",function(){a(this).remove()}),d.push=a.ajaxQueue({method:"POST",url:g,data:{action:"cancel_appt",appt_id:f},success:function(b){a(".appt-block").animate({opacity:1},150)}})}return!1}),a("body").on("click",".bm-overlay, .bm-window .close, .booked-form .cancel",function(a){return a.preventDefault(),close_booked_modal(),!1}),a("body").on("focusin",".booked-form input",function(){this.title==this.value&&(a(this).addClass("hasContent"),this.value="")}).on("focusout",".booked-form input",function(){""===this.value&&(a(this).removeClass("hasContent"),this.value=this.title)}),a("body").on("change",".booked-form input",function(){var b=a(this).attr("data-condition"),c=a(this).val();b&&a(".condition-block").length&&(a(".condition-block."+b).hide(),a("#condition-"+c).fadeIn(200))}),a("body").on("submit","form#ajaxlogin",function(b){b.preventDefault();var c=a("#data-ajax-url").html();a("form#ajaxlogin p.status").show().html(i18n_please_wait),d.push=a.ajaxQueue({type:"post",url:c,data:a("form#ajaxlogin").serialize(),success:function(b){if("success"==b){var c=a("#newAppointmentForm input[name=timeslot]").val(),d=a("#newAppointmentForm input[name=date]").val(),e=a("#data-ajax-url").html(),f=a("#newAppointmentForm").attr("data-calendar-id");return a(".bm-window").load(e,{load:"new_appointment_form",date:d,timeslot:c,calendar_id:f}),!1}a("form#ajaxlogin p.status").show().html(i18n_wrong_username_pass)}}),b.preventDefault()}),a("body").on("click",".booked-form input#submit-request-appointment",function(d){d.preventDefault();var e=a("#newAppointmentForm input[name=customer_type]").val(),f=a("#newAppointmentForm input[name=user_id]").val(),g=a("#newAppointmentForm input[name=first_name]").val(),h=a("#newAppointmentForm input[name=first_name]").attr("title"),i=(a("#newAppointmentForm input[name=last_name]").val(),a("#newAppointmentForm input[name=email]").val()),j=a("#newAppointmentForm input[name=email]").attr("title"),k=(a("#newAppointmentForm input[name=phone]").val(),a("#newAppointmentForm input[name=mobile]").val(),a("#newAppointmentForm").attr("data-calendar-id")),l=!1,m=[];if(a(this).parents(".booked-form").find("input,textarea,select").each(function(b,c){var d=a(this).attr("required");if(d&&"hidden"==a(c).attr("type")){var e=a(c).attr("name");if(e=e.split("---"),fieldName=e[0],fieldNumber=e[1].split("___"),fieldNumber=fieldNumber[0],"radio-buttons-label"==fieldName){var f=!1;a('input:radio[name="single-radio-button---'+fieldNumber+'[]"]:checked').each(function(){a(this).val()&&(f=a(this).val())}),f||(l=!0)}else if("checkboxes-label"==fieldName){var g=!1;a('input:checkbox[name="single-checkbox---'+fieldNumber+'[]"]:checked').each(function(){a(this).val()&&(g=a(this).val())}),g||(l=!0)}}else d&&"hidden"!=a(c).attr("type")&&""==a(c).val()&&(l=!0)}),l)return alert(i18n_fill_out_required_fields),!1;if("current"==e&&f||"guest"==e){$thisButton=a(this),$thisButton.val(i18n_please_wait).attr("disabled",!0).after('<span class="temp-loading-spinner">&nbsp;&nbsp;<i style="font-size:25px; color:#aaa; position:relative; top:5px;" class="fa fa-refresh fa-spin"></i></span>'),$thisButton.parents("form").find("button.cancel").hide(),a(".booked-form input").each(function(){thisDefault=a(this).attr("title"),thisVal=a(this).val(),thisDefault==thisVal&&a(this).val("")});var n=a("#data-ajax-url").html(),o=a("td.active");return m.push=a.ajaxQueue({type:"post",url:n,data:a("#newAppointmentForm").serialize(),success:function(d){d=d.split("###");var e=d[0].substr(d[0].length-5);"error"==e?($thisButton.val(i18n_request_appointment).attr("disabled",!1),$thisButton.parents("form").find("button.cancel").show(),a(".temp-loading-spinner").remove(),a(".booked-form input").each(function(){thisDefault=a(this).attr("title"),thisVal=a(this).val(),thisVal||a(this).val(thisDefault)}),alert(d[1])):(a(c).trigger("booked-on-requested-appointment"),profilePage&&(b.location=profilePage+"?appt_requested"))}}),!1}if("new"==e&&g!=h&&i!=j){a(".booked-form input").each(function(){thisDefault=a(this).attr("title"),thisVal=a(this).val(),thisDefault==thisVal&&a(this).val("")}),$thisButton=a(this),$thisButton.val(i18n_please_wait).attr("disabled",!0).after('<span class="temp-loading-spinner">&nbsp;&nbsp;<i style="font-size:25px; color:#aaa; position:relative; top:5px;" class="fa fa-refresh fa-spin"></i></span>'),$thisButton.parents("form").find("button.cancel").hide();var n=a("#data-ajax-url").html(),o=a("td.active");return m.push=a.ajaxQueue({type:"post",url:n,data:a("#newAppointmentForm").serialize(),success:function(d){d=d.split("###");var e=d[0].substr(d[0].length-5);"error"==e?($thisButton.val(i18n_request_appointment).attr("disabled",!1),$thisButton.parents("form").find("button.cancel").show(),a(".temp-loading-spinner").remove(),a(".booked-form input").each(function(){thisDefault=a(this).attr("title"),thisVal=a(this).val(),thisVal||a(this).val(thisDefault)}),alert(d[1])):(a(c).trigger("booked-on-requested-appointment"),a("tr.entryBlock").find("td").load(n,{load:"calendar_date",date:d[1],calendar_id:k},function(){a("tr.entryBlock").find(".booked-appt-list").show(),a("tr.entryBlock").find(".booked-appt-list").addClass("shown")}),o.load(n,{load:"refresh_date_square",date:d[1],calendar_id:k},function(){var c=a(this);c.replaceWith(c.children()),adjust_calendar_boxes(),profilePage?b.location=profilePage+"?appt_requested&new_account":close_booked_modal()}))}}),!1}("new"==e&&g==h||"new"==e&&i==j)&&alert(i18n_appt_required_fields)}),h.resize(function(){adjust_calendar_boxes(),f()}),adjust_calendar_boxes()}),a(c).ajaxStop(function(){g(!1)})}(jQuery,window,document),function(a){var b=a({});a.ajaxQueue=function(c){function d(b){e=a.ajax(c).done(f.resolve).fail(f.reject).then(b,b)}var e,f=a.Deferred(),g=f.promise();return b.queue(d),g.abort=function(h){if(e)return e.abort(h);var i=b.queue(),j=a.inArray(d,i);return j>-1&&i.splice(j,1),f.rejectWith(c.context||c,[g,h,""]),g},g}}(jQuery);